BoF: Introduction to Contour, A High Performance Multitenant Ingress Controller for Kubernetes: CHXA-6971 - events@cncf.io - Thursday, August 20, 2020 6:59 AM - 52 minutes

Participant: wordly [W] English (US)

Transcription for wordly [W]

00:00:14 [W] Hello everybody and welcome to our presentation today.
00:00:18 [W] We will be talking about Contour a high-performance multi-tenant Ingress controller for kubernative.
00:00:22 [W] Where we are your presenters today, my name is Michael Michael.
00:00:28 [W] I'm one of the Contour maintainers and a product lead director of product management at VMware and you can find me as Add Em to on the kubernative slack.
00:00:38 [W] Hi everybody.
00:00:40 [W] I'm Nick Young.
00:00:43 [W] I'm the another Contour maintainer.
00:00:45 [W] I'm actually the also the technical lead.
00:00:50 [W] I'm a Staff engineer at VMware and you can find me at Young Nick on giving any slack back over to you Michael.
00:00:52 [W] Thank you, Nick.
00:00:54 [W] All right.
00:00:59 [W] So what is Contour so if you're not familiar with an increase controller essentially an English controller is kubernative object type that enables you to basically send networking trafficking from outside the cluster to some of your
00:01:10 [W] deployment in your part in your containers running in a kubernative cluster and our Contour is really an open source increase controller and it provides a control plane for the invoice age and service proxy some of our key advantages is
00:01:26 [W] Let me configuration updates.
00:01:30 [W] We are actually very secure and we enable a multi-team increase delegation out of the box and essentially maintain a very lightweight profile the way the way in the reason that the bill Contour is added s very simple
00:01:44 [W] And out of the box and essentially maintain a very lightweight profile the way the way in the reason that the bill Contour is added s very simple English control that does one thing and does it very very well and that http.
00:01:48 [W] As one thing and does it very very well and that HTTP layer 7 Ingress for your kubernative deployments.
00:01:58 [W] Contour was started at Hefty. Oh back in September of 2017 and last November. We released our version 1.0 signaling to the community that will have a stable API and we can have our users to
00:02:08 [W] Start deploying Contour in production and then in July of 2020. We were able to donate Contour to the cncf at the incubation level.
00:02:23 [W] So now we'll have open governance.
00:02:30 [W] We encourage many and all contributors to come and help us deliver on the vision of Contour.
00:02:32 [W] Our mission is to be the most secure performant scalable and available Ingress controller for kubernative.
00:02:39 [W] What are some of the Contour features so let's let's take a look at the kind of the main features that Contour is delivering today as an advanced English controller. That is a significant
00:02:55 [W] The built in English that exist today.
00:02:59 [W] Well, I you to safely use multi-team Ingress in kubernative or the means is that if you have two different teams that are in the same cluster.
00:03:08 [W] It is very important that those two teams don't override each other settings.
00:03:18 [W] So controller enables that multi-tenant delegation of Ingress objects also have new Concepts like inclusion and conditions while I do too. We allow you to do Dynamic reconfiguration and you can actually
00:03:25 [W] See some of that in our demo.
00:03:31 [W] Well, I will do mirror service capabilities who have request and response header manipulation.
00:03:38 [W] We can do host rewriting to external domains. And we also have prefix re right supports a lot of the features that are needed by users today to be able to safely send traffic to their kubernative objects.
00:03:48 [W] We consider ourselves to be a very good cncf ecosystem citizen were built for kubernative were reusing envoi inside so we didn't go and Implement our own prodyna.
00:03:55 [W] See and we're using one of the other graduated projects in the cncf ecosystem and voy and now we're also a cncf incubating project as well and from a security standpoint.
00:04:09 [W] I kind of mentioned this already. We do secure Ingress delegation.
00:04:12 [W] From an architectural perspective.
00:04:18 [W] Block that traffic is going to come from the outside of the cluster.
00:04:32 [W] It's going to hit the load balancer that you have deployed in your environment.
00:04:36 [W] And from the load balancing is going to hit the envoi deployment inside your kubernative cluster.
00:04:41 [W] That's the envoy deployment that gets deployed as part of kubernative now and which can act as your labor layer seven layer for proxy here and it's going to send that traffic directly to the Pod and ployment that you have inside kubernative.
00:04:54 [W] So notice that in this traffic pattern componentconfig.
00:04:55 [W] Contour is not in the data path control is a control plane for Android and it's not in the data path now envoy's connect take care of everything from load balancing your request based on configuration and routing them to the right place.
00:05:10 [W] Patterned Contour is not in the data path control is a control plane for Android and it's not in the data path. Now envoy's connect take care of everything from load balancing your request based on configuration and routing them to the
00:05:12 [W] Does it do that?
00:05:13 [W] Well Contour the weight gets deployed.
00:05:27 [W] It listens to the API server to watch a lot of the different objects that we need to make sure we understand in order for us to properly configure and voiceover looking watching objects like Ingress services and
00:05:32 [W] It's HTTP proxy and in the past.
00:05:39 [W] She also used to monitor English route, which has been deprecated.
00:05:39 [W] So as we're monitoring all these objects from kubernative when the standard State understand where everything is deployed, and then at the same time, we make XDS API calls to envoi to configure and void so that envoi can probably route the traffic that's coming
00:05:54 [W] No to your cluster and Route the traffic directly to your pods.
00:06:00 [W] Hi everyone. So we the first thing I need to explain is that we ship on a monthly Cadence we every month we have the Release Train pulls out of the station and whatever is in our Master
00:06:16 [W] Guidance we every month we have the Release Train pulls out of the station and whatever is in our Master at that time is what we will ship the accepted that is obviously cves or
00:06:23 [W] Is what we will ship the accepted that is obviously CVS or other security issues either Contour internal or envoys will ship a patch as close to immediately as we can manage recently.
00:06:32 [W] We've some of the big features we've shipped our client certificate authentication using our CID HTTP proxy that allows you to make sure that the person the client that's connecting to your service is the one that you think it is and it's all handled at the envoy
00:06:45 [W] At the envoy level. We also added a hot reload of certificates for securing the communication between contour and Envoy.
00:07:00 [W] We've included an invoice shutdown manager to help your connections drain more Glide gracefully when you're swapping out your own voice and we've deprecated in removed Ingress router, which is our previous version of a CID as it
00:07:10 [W] By HTTP proxy it at this point back over to you Michael.
00:07:26 [W] So so let's talk a liver roadmap. Like Nick mention wish a pretty much on the can on a monthly Cadence, but also have a very well-documented public road map that's linked at the bottom of this slide and I want to outline some of our key goals, you know at the top of our
00:07:32 [W] We align with the Upstream effort around what used to be known as Ingress vicious to or the next generation of Ingress.
00:07:42 [W] Now, the new name is service apis.
00:07:48 [W] We've done a lot of great things about contour and build a high-performance Ingress controller for kubernative that works and much as a lot of our scenarios. Now, we're going to take a lot of those learnings and we're going to hope the Upstream networking community in the cncf in the
00:07:59 [W] To design the best possible service apis.
00:08:05 [W] We're going to take a lot of the learnings from contour and apply them to service apis.
00:08:15 [W] But at the same time we want to make sure I line with service apis and Contour is one of the first solutions to implement the new specification.
00:08:20 [W] So you're going to see a lot of that work coming from our Contour community.
00:08:23 [W] Then we hear a lot of feedback from users.
00:08:24 [W] They want more and void configuration knobs and voice fairly complicated and is fairly powerful as well.
00:08:32 [W] And it has a lot of configuration in it. And what we've done control so far was we tried to be an opinionated control plane for envoi, but it doesn't seem that it works for all our users.
00:08:45 [W] So we're going to start exposing more Envy configuration knobs.
00:08:49 [W] We're going to start adding more features that then voice supports today like authentication support for services rate-limiting support for Access log service and so on and so forth. We're also going to start giving you an easier way to deploy a contour.
00:09:02 [W] Some deployment enhancements as well as a Helm chart so you can see we have a very good pulse of our community and want to make sure we listen to them and get all those requests prioritize them and then deliver them on our roadmap.
00:09:15 [W] There's 50 releases a hundred companies are contributing to contorted a 650 slack members lots of blogs and cubicle talks and presentations lots of Twitter followers if you want to engage with us.
00:09:45 [W] / what a welcoming Community go to Project contoured iot finder Community meetings. We meet very frequently in time zones are both friendly to Europe Asia as well as the United States if you want to come and fix some bugs
00:10:00 [W] Access good first issue so you can get started with some of the easy bugs in our in our repo but communicate with us.
00:10:13 [W] What on slack mailing list Twitter.
00:10:15 [W] You have a GitHub here and we record pretty much every presentation and meeting that we have and you can find it on our YouTube playlist on the right.
00:10:26 [W] So now given you a good overview of what Contour is but seeing is believing. So let's switch to a demo by Nick. Yang.
00:10:30 [W] Okay, am I coming on through there, Michael?
00:10:37 [W] Absolutely.
00:10:39 [W] Thank you.
00:10:40 [W] Okay, great.
00:10:47 [W] So yeah today where I'm going to run you through some basics of Contour first and then show you a more advanced more advanced demo. So today, we're going to be talking about two companies fill and bar the food come from the food
00:10:56 [W] They for some reason they share a community's cluster and the food company needs to expose a pretty typical English config the old-school Ingress looks like this one.
00:11:12 [W] We've got you know the host the host name is food or young authoritative and all of that traffic should be sent out to the Food Service on Port 80 and we've got TLS configured there as well. Now
00:11:24 [W] Just keep doing that though because we have our shiny CID HTTP proxy.
00:11:32 [W] So I've applied this HTTP proxy to this cluster.
00:11:39 [W] You can see it's pretty similar and there's a virtual host definition sets up the same Fu DN same TLS details and says all traffic should be routed to Foo on Port 80. So it's exactly the same just a slightly different container for holding in this case.
00:11:51 [W] Here that this is the food web site.
00:11:57 [W] They you know, they make squeezers.
00:11:59 [W] They don't even know what they are, but they make them anyway, and but you can see this is all working.
00:12:04 [W] I can refresh as many times as I like everything is up and running now using the same kubernative cluster.
00:12:12 [W] We've also got another company bar now bar has a slightly more complicated requirement in that they have a separate marketing department that would like to be able to coordinate some campaign's themselves. So what the
00:12:21 [W] cluster administrator of the bar company can do is set up a our other option here and kind of measure how our customers are basically taking into those new new campaigns.
00:12:36 [W] Yes.
00:12:36 [W] Yeah. We totally can great great that you asked so we can we can edit the object.
00:12:45 [W] Sorry.
00:12:46 [W] I'm going to change names face first and then we can
00:12:52 [W] Jim that everything works.
00:12:53 [W] Yes, we can edit the object.
00:12:58 [W] It's okay.
00:13:03 [W] Can we see my screen here?
00:13:08 [W] Can you see this one?
00:13:10 [W] Yeah, can you increase the size of it that perfect.
00:13:11 [W] There we go.
00:13:13 [W] Okay. So what we can do here is we can add a weight.
00:13:19 [W] So which one should we have the more mr.
00:13:19 [W] Send for the free and then put the rest of the ninety percent for the cheap.
00:13:27 [W] There we go. Okay, so I'll save
00:13:32 [W] headed back out of there.
00:13:35 [W] That's been edited.
00:13:42 [W] So we just check that that has taken effect.
00:13:43 [W] You can say that the weight has been accepted now when we hit refresh most of the time we should get cheap ones, but occasionally will get a free one.
00:13:55 [W] This is perfect.
00:14:04 [W] So I Sonique this is you know, this is a great way for a kubernative operator the kind of delegate that ministration and the configuration of this Ingress to the team that kind of owns the application as well.
00:14:12 [W] So in this case, you've delegated to the bar marketing team so that they kind of own their own fade in terms of what configuring the English and configuring the routes in a way that makes sense to them.
00:14:22 [W] Exactly.
00:14:26 [W] Yes, I and it's completely up to them. How do I do that - I don't need to have to and do A/B Testing. They could remove they could edit the object and remove one or the other of those things that any time they have complete control over that subsection of the website in this case the condition the condition
00:14:38 [W] As we could see earlier the condition said that they've been given is just that it has to be / campaign. So anything that goes to Bardock young adult Dev that the does campaign will be routed to whatever is in
00:14:54 [W] This special offer things. So if they create further routes inside that special offer one, then they can further subdivide their thing. They can even further they can add includes into their own one and subdivide the responsibility even further if that's what they want.
00:15:09 [W] Yeah. This is this is great and this coming back to what you mentioned about Contour were an English controller for HTTP traffic we do that we do that very well and do it in a clean way so that different teams don't trample over each other
00:15:22 [W] The community's name space.
00:15:26 [W] Yeah, that's right.
00:15:33 [W] And one of the reasons that we've built a lot of this was just to really enable people to have this sort of more centrally managed set up because we found one of the things when working with customers was that we found was that sometimes with Ingress and other things that
00:15:41 [W] have that the they would be times when people would inadvertently stomp on each other's config and you'd end up with your website outages just because someone applied the wrong thing to the wrong cluster, which nobody wants absolutely
00:15:56 [W] Conclusion of our demo and our slides and we're going to leave ample time for Q&A so that you are Community can ask us the questions that you want to ask and hopefully we'll be able to provide answers to all of them. Thank you for me.
00:16:12 [W] Thanks for Meto.
00:16:14 [W] Hi everyone.
00:16:24 [W] Hello everybody.
00:16:25 [W] Good morning.
00:16:25 [W] Good afternoon.
00:16:26 [W] Good evening, depending on where you are on the world indeed indeed.
00:16:34 [W] So thanks for all the questions everyone. I can see we've got we've got quite a few have come through.
00:16:42 [W] There's actually a few that I can answer all together. If you don't mind Michael all I'll take the first set.
00:16:46 [W] Yeah, great. So we've got so we've got a question from sorry. I'm a
00:16:52 [W] And names incorrectly a sham. I think says isn't the HTTP proxy feature overlap with traffic to split feature of a servicemeshcon.
00:17:21 [W] What do you mean by multi-team support?
00:17:26 [W] Haproxy does is a custom CID that's designed for doing that delegation that I demonstrated in the demo.
00:17:40 [W] It's designed to have a central team be able to parcel out access to some parts of website so that so that you can delegate control of parts of the website and have the team there be able to
00:17:53 [W] Central team be able to parcel out access to some parts of website so that so that you can delegate control of parts of the website and have the team there be able to do anything they like with that part of the website and
00:17:57 [W] with that part of the website and so the I think so that sort of that sort of one of the things that sets Contour part from Ambassador and it's also the thing that
00:18:09 [W] Made by multi-team support.
00:18:16 [W] It's really it's really useful for multiple teams to be able to coordinate via the API.
00:18:21 [W] Once the central team sort of sets the things up then then the multiple teams can't step on each other.
00:18:23 [W] That's what that's what haproxy is designed to do. So and I think many like, I think that Williams question is quite fair, you know, yeah many of the features many of the features and the roadmap are pretty similar to
00:18:36 [W] And I think many like I think that Willems question is quite fair, you know.
00:18:37 [W] yeah many of the features many of the features and the roadmap are pretty similar to what our friends over at a better to do.
00:18:47 [W] But I think that the the delegation feature is probably the big thing that sets a says Contour apart from a lot of the other Ingress controllers out there now I can see
00:18:49 [W] Stop me if you want to answer any Michael, but I'll keep going. Otherwise, yeah, go ahead.
00:18:55 [W] Thank you.
00:18:56 [W] Yeah, no worries. So I can see you. There's a couple questions about you know, what's the different you how does an English controller compared to an API Gateway?
00:19:11 [W] Well, I mean the kind of different things and English controller is about getting traffic from outside your communities cost at inside.
00:19:11 [W] That's it.
00:19:16 [W] A lot of the English controllers have grown API Gateway like features you so Contour kind of has a little
00:19:19 [W] That because of the ability to Route Things based on based on headers and two different paths to different services and some other things like that, but it's first and foremost an Ingress controller rather than an API get way.
00:19:34 [W] It's kind of an Ingress controller that has some API Gateway features rather than the other way around Mark Jensen asks, are there any features missing in Contour compared to what's in Ingress nginx?
00:19:46 [W] Are at the moment most of most of the feet where build most of the features that we're missing our on our roadmap some of the big ones are external auth and a few other extra configurability options.
00:20:02 [W] One of the things that we have tried to do with Contour though is to avoid using annotations to configure a lot of these options I to you engineering Ingress nginx is a great product.
00:20:14 [W] that is really flexible. But one of the problems that I have with it is that
00:20:17 [W] If you want to configure anything, you need to go to a page that has I think I counted it was a hundred and a hundred and something annotations that you know that you might need to configure and so by designing our own CID.
00:20:32 [W] CID. We're trying to make it a little easier to only take the bits of complexity that you actually need.
00:20:35 [W] So there are a couple of other questions about Envoy ego asks, do we provide the ability to integrate custom filters into Envoy that works together with with Contour. We currently do not know we have talked about
00:20:51 [W] I haven't been able to come up with a good way to do that yet. If you would like to talk to us more about that and about your use case. I would please come and visit us in our then Contour on the kubernative slack or logon issue at
00:21:06 [W] Bol.com / project Contour / contour and yeah, I'd love to I'd love to hear more about your use cases.
00:21:19 [W] They're the same the same goes for Wolfgang's question about the is impossible to use in voy a sink SSL handling.
00:21:26 [W] So I'm not exactly sure what you mean. Now I'm you will terminate their cell connection or pass it through as you wish so I'm not exactly sure yet. Both basically Contour is all about providing you a relative.
00:21:39 [W] Ella tively easy to get started with HTTP Ingress experience that can grow with you as you need to tweak bits.
00:21:52 [W] We've been adding a lot of stuff about tweek ability lately and we will contend We are continuing to add that.
00:22:00 [W] that. Yeah, so I think and that's that's sort of our big growth area in the next little while.
00:22:01 [W] Yeah, also an econ one thing to note to everybody is that we have media maintainer office hours later on today.
00:22:12 [W] It's going to be at 8 o'clock Central East European Standard time or 1 p.m.
00:22:19 [W] Central u.s.
00:22:20 [W] Time zones.
00:22:21 [W] depending where you are.
00:22:26 [W] So if you want to have a bi-directional community conversation with us, please come there.
00:22:30 [W] We can also talk to you and slack you can attend one of the Contour Community meetings there.
00:22:33 [W] Yeah, yeah.
00:22:45 [W] So Manuel asks, do we support hose Port mode to skip the OB so I mean, I wouldn't you wouldn't want to skip the envoy proxy but we do support any
00:22:54 [W] Traffic to Envoy will work with Contour. All Contour does is take the kubernative config and give it to Envoy and then as long as you have your traffic can get to the envoys the outside Port of envoy and and then get to the pods that are
00:23:10 [W] Any deployment of envoy will work.
00:23:16 [W] So hopefully that answers your question Manuel charm asks, is it possible to restrict the namespace to use a specific if qdn on the well, yes in a way the way that you do that, is that when
00:23:28 [W] When you create haproxy these you can make it so that HP properties that contain a few d-ends.
00:23:38 [W] We call a route HTTP proxy and the day can be restricted to only a certain set of namespaces.
00:23:52 [W] And so that only a certain set of users can create them. And then what you do is you create a child haproxy that has some part of the website delegated to it and maybe it's all of the website in another namespace and then
00:23:58 [W] and then any and then those people who own that namespace can further delegate from there.
00:24:08 [W] That's that's the sort of the way that it's intended to do that sort of design show.
00:24:13 [W] It's a great question.
00:24:19 [W] These are please keep them coming.
00:24:20 [W] He's awesome.
00:24:25 [W] I know it's early in the morning for some of the u.s.
00:24:25 [W] Time zones afternoon in Europe, but we're seeing great attendance here.
00:24:37 [W] So thank you all for coming to a project or we're actually very excited to be part of the cncf now and looking forward to taken to to even greater Heights.
00:24:40 [W] So yeah, absolutely by Igor. Yeah. So Eagle asses it would be good to have a solution for public and private Ingress if customers your contour for yourselves, but the standard solution weaveworks.
00:24:51 [W] um, so I'm not sure what you mean by public and private Ingress, but maybe that's something we could talk about more on slack afterwards, but the yeah, I mean right now the sort of way that we've seen people do that is to run
00:25:07 [W] Contour and two sets of envoy to set the one voice not ideal all the time. But yeah again, it depends on what you mean by public and private Ingress I guess.
00:25:16 [W] so yeah, keep those questions coming if you
00:25:31 [W] Yeah, if you would like us to answer more questions like he live.
00:25:37 [W] otherwise we can if no one else wants to ask questions here. We can wrap them up and take it to Slack.
00:25:43 [W] awesome
00:25:58 [W] I'll give it another minute just in case everyone's anyone still typing but then after that we
00:26:08 [W] so yeah, after that we will be in the
00:26:18 [W] It's going to pull up.
00:26:22 [W] It's a message in a little bit Yeah Yeah, you could apply to your question.
00:26:26 [W] He did.
00:26:27 [W] Okay, right.
00:26:27 [W] Right.
00:26:29 [W] Okay.
00:26:29 [W] Yes.
00:26:31 [W] Yes ego.
00:26:32 [W] Thanks for that.
00:26:33 [W] So yeah you go. Yeah, the best way at the moment to do that is to is to split the
00:26:44 [W] is to split the Contours and restrict what Contours have access to to to the different Services.
00:26:55 [W] Excellent.
00:26:55 [W] Thank you.
00:26:57 [W] Thanks for the questions ago.
00:26:59 [W] And yeah Wolfgang.
00:27:01 [W] Yes right now, I don't I don't think we have anything to do that.
00:27:05 [W] that. But yeah, if you would like it, please come along and come to the repo and create an issue and we'll talk about it. That sounds great.
00:27:12 [W] And thanks Andrew for the nice comments as well.
00:27:18 [W] Okay.
00:27:22 [W] Well, I think we might call it there. Please come in come in to the thread in the
00:27:29 [W] Que con maintainer Channel, and we can have a chat in there.
00:27:36 [W] Thanks very much everybody for time.
00:27:39 [W] Yeah, thank you all and see you and have a great show Ron as well.
00:27:44 [W] Yep. Have a great coupon.

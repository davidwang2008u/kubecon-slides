Handling Container Vulnerabilities with Open Policy Agent: UKRY-0253 - events@cncf.io - Tuesday, August 18, 2020 8:21 AM - 79 minutes

Participant: wordly [W] English (US)

Transcription for wordly [W]

00:04:02 [W] Hi everyone.
00:04:05 [W] Thank you for taking the time to attend the myself.
00:04:06 [W] Hi everyone.
00:09:08 [W] Thank you for taking the time to attend the my session and to be of crude oil from the organs of steam in of course security and the maintenance therapy, which is vulnerability scanner for containerd images today.
00:09:21 [W] we talking about vulnerability handling with auto policy agent?
00:09:25 [W] There are a lot of software vulnerabilities in the world usually cvid is assigned to each vulnerability in the case of Heartbleed. Zebrium. 2014. The 160 is a sign.
00:09:39 [W] Do you know how many ban abilities are reported per year?
00:09:43 [W] This shirt is from NBD National. Urban Mobility database basically listing all cbid assigned a burn abilities in 2019.
00:09:55 [W] It's has increased year by year. In other words about 47 band abilities or reported a day.
00:10:15 [W] Basically, you have to understand how burn abilities work in order to know how much impact it is. But you know, it's not easy you might take a few hours to understand
00:10:23 [W] 24 hours is not enough to figure out the 47 band abilities.
00:10:31 [W] If your organization has a huge security team, you might even be able to do that, but you should not do that since 47 burn abilities have a lot of noise.
00:10:43 [W] It may include but abilities or windows open SSL python kubernative.
00:10:52 [W] What what if your organization doesn't use Windows and crouppen right this
00:10:57 [W] You don't need to look into drawers burn abilities.
00:11:01 [W] So asset management is essential for this purpose.
00:11:10 [W] You should know which always package programming language library and Equipment are used in your system if you remove and abilities related to software you system
00:11:21 [W] You can reduce vulnerabilities. You have to look into for example, it might be five or three possibilities, depending on your organization. Should we do this process of manually, let's
00:11:38 [W] Organization should we do this process of manually?
00:11:39 [W] Let's take about the container image a container images should include all software.
00:11:44 [W] It's going to use all you have to do is extract information from the container. Like the image is based on Debian and uses Java then cross reference to security advisories from vendors.
00:11:58 [W] It sounds easy, but it's still hard to do it for all Container images manually and periodically.
00:12:06 [W] For the purpose you can use a burner ability scanner, which automatically they are the things I explain just before there are many Security Solutions in the crowd knative Adia mixing open
00:12:22 [W] is manually and periodically
00:12:23 [W] poor that purpose you can use the vulnerability scanner, which automatically doesn't does the things I explain just before there are many Security Solutions in the crowd knative a Bia mixing open
00:12:26 [W] Commercial products it also includes three being I developed applying vulnerability scanning reduces the number of urban abilities. You have to investigate do you think five and
00:12:38 [W] For to camp and abilities are small. This number is just an example and it should be different depending on your system and your organization, but I'm sure it must not be 0
00:12:53 [W] But abilities, I don't think this value is small enough as I told you earlier.
00:13:02 [W] It might take a few hours to look into vulnerability.
00:13:04 [W] How can we reduce variability is more take a look at this chart?
00:13:15 [W] about nobility basically has a CBS s base score indicating disability.
00:13:19 [W] the squirrel bodies from zero to 10 10 mins the most critical CBI says consists of three metric groups base temporal and environmental but in this presentation,
00:13:34 [W] Think about the base metrics and score because nvda provides base Matrix only.
00:13:44 [W] as you can see there are not so many high-risk burn abilities only five point seven percent of the but abilities Harbor score of 8 or more filtering based on CVS's scores
00:13:59 [W] Reduce vulnerabilities. It might be 0 over 1 but ability if you look into
00:14:06 [W] critical vulnerabilities only
00:14:09 [W] of course 0 1 depends on your your system.
00:14:21 [W] Let's consider whether the sea basses score is reliable in the case of how to breathe which effects openfaas L. The CVS is boot to score. It sets 5.0 medium
00:14:33 [W] Pop your system.
00:14:34 [W] Let's consider whether the sea basses score is reliable in the case of how to breathe which effects openfaas L. The CVS is boot to score. It sets 5.0 medium
00:14:35 [W] You visit score.
00:14:38 [W] It doesn't look like it's a dangerous vulnerability.
00:14:42 [W] Can we think about this vulnerability as negligible and ignore it as noted in this article hackers exploited this vulnerability.
00:14:53 [W] So this vulnerability is not negligible.
00:14:59 [W] In addition. The CVS's score is provided by each vendor in this example and VD set. The score is nine point one.
00:15:04 [W] great car while red hot sets 5.9 moderate
00:15:09 [W] The bodies are often different.
00:15:14 [W] I'm not saying don't use the C versus score that it's a bit risky to rely on cbs's scores too much.
00:15:25 [W] We should Define our own policy for but nobody handling for example, our container image uses bash, but we can accept the risk of bashful and abilities as bashes not internet-facing, of course if
00:15:37 [W] Pretty thoroughly. You should have deleted from the image.
00:15:44 [W] Also, you might be able to accept the risk of cross-site scripting. If you assist them in the static website and you perhaps saying Northern ability, which requires the user interaction like opening the email and
00:15:57 [W] This policy should be customized depending on your system and requirement.
00:16:04 [W] And the system managing customers are set to like the bank account and the system just publishing the article like the Bronx must have different policies.
00:16:16 [W] I recommend the defining the policy for vulnerability handling if the vulnerability is batch related or cross-site scripting or requires user interaction, then
00:16:32 [W] Quite as negligible, but nobility if it doesn't match any room you have to fix the vulnerability by updating the Persian or something another way. Actually, they are extremely useful information
00:16:47 [W] Andre such a fee basis vector and cwid
00:16:53 [W] CBS s Vector string consists of eight elements called CBS s Matrix each metric value is used to score the vulnerability. For example attack Vector this metric reflects the
00:17:09 [W] The exploitation is possible.
00:17:18 [W] This metric body will be larger than the more remote and Target can be in order to exploit the vulnerable component.
00:17:22 [W] In addition to attack Baxter you can find privilege required user interaction and so on.
00:17:30 [W] CW e common weakness in the Malaysian and still provide a common base to identify the type of software but ability for example cw17 8 is voice command injection and
00:17:46 [W] 89 is SQL injection. Now, you can relight the policy using these metrics you want to know example number it is excesses.
00:18:02 [W] You can check if cwid is cwe in 79 or not. If you want to know except an ability requires user interaction, you can check if user interaction in cbs's Baxter is
00:18:14 [W] Except an ability requires user interaction.
00:18:15 [W] You can check if user interaction in C versus Baxter is required.
00:18:16 [W] So it allows you to handle Urban abilities automatically and I proposed to use open policy agent to automated vulnerability handling.
00:18:27 [W] Open purse agent is Princess Porsche engine and cncf project.
00:18:40 [W] You have to write a policy written by Rego and pass it to Opera with include Jason Opera evaluates the policy and Returns the result.
00:18:45 [W] It's usable as alright bologna and the service.
00:18:48 [W] Now you can put the policy into Reagan.
00:18:53 [W] The poor see written in regular should be like this on the right. You can see the vulnerability detail of the input.
00:19:04 [W] You can see the package name cwid see debris i d 70 score a vector on the left.
00:19:16 [W] You can see the pretty simple rules if the package name is Bash or one cwid is 79 or user interaction is required or css-based score is less than K boom.
00:19:29 [W] an ability is going to be negligible.
00:19:31 [W] Corporal should reduce the vulnerabilities to 0 or a 1 a day depending on the policy.
00:19:41 [W] VI D c-- debris i d 70 score Baxter on the left. We can see the pretty simple rules if the package name is Bash or cwid is 79 or
00:19:47 [W] Always correct if anybody says user interaction is required. It might be wrong. Don't trust the youth but a bit information too much.
00:19:55 [W] Even if it's correct and their policy Max it are negligible.
00:20:02 [W] It doesn't mean there is no risk.
00:20:06 [W] It means you decide to accept the risk the balance of risk and cost is important.
00:20:10 [W] If there are many people in a security team and the organization can take the cost of security you may be able to look into the patches and primary source of old but abilities if it's not the case in your organization.
00:20:26 [W] Probably needs a policy to accept some risk.
00:20:33 [W] Here's a summary of what I've been talking about so far at first, but nobody scanning filters to only those vulnerabilities that are relevant to your organization then or Pro filters out burn abilities that you can accept
00:20:45 [W] This whole process is automated.
00:20:54 [W] You can just focus on the band abilities in the final output.
00:20:54 [W] As a case study. Here's the Rook up the Rope integration in tribute.
00:21:00 [W] In this example 3D scans an image and detects abandonment button abilities. Then oppai barrier is the result.
00:21:11 [W] Okay. So before that, let me explain trivia a little.
00:21:16 [W] It's an open source cannot for container images to be has a bunch of features.
00:21:29 [W] And especially it can be integrated into the Cs system such as guitar actions and Jenkins easily.
00:21:32 [W] Recently three be supported or paint aggression to fill turbine abilities.
00:21:38 [W] You can pass a regular file defining your policy. Beer - - ignore policy option.
00:21:46 [W] If your policy Max the vulnerability negligible, it will ruin it will not be displayed in the result.
00:21:54 [W] The structure which but ability input is the same as for the trivia Json output. It includes severity and celebre IDs cbs's better and score and so on.
00:22:10 [W] pause see basis Vector p 3 which converts even suspect a string to an object so that you can easily access each metric this example ignores some packages like bash by the
00:22:31 [W] And p.m.
00:22:35 [W] Because they are not used in the production environment as mentioned earlier on necessary packages should be removed from the container image. But if it's difficult, you can ignore packages in the rebel policy
00:22:48 [W] But abilities with low and medium severity can be accepted also when it's not the exploitability motoring or I could be quite as high privilege like Administration or
00:23:04 [W] And they will be marked negligible in this example. Okay, so let me show the demo or Pi integration interview CLI.
00:23:15 [W] At first let's try scanning centers table without any policy in this term of the result to be terror is not needed.
00:23:24 [W] So I will be directed to the nerve because he's a number of important ability 622.
00:23:31 [W] It's a hard task to check all the vulnerabilities next looking into the Porsche example, as I explained it ignores some packages some civilities and vulnerability.
00:23:43 [W] Ask to check all the button abilities next looking into the Porsche example as I explained it ignores some packages some civilities.
00:23:45 [W] And vulnerability and that can't be exploited remotely or requires high privilege, right administrator or requires user interaction or cross-site request forgery in
00:23:57 [W] People let's write our administrator or requires user interaction or cross-site request forgery in this case.
00:24:02 [W] Okay, let's apply this policy to the result strimzi showed.
00:24:06 [W] You can press the rec of wire be a - - even though Porsha option as you can see there are seven but abilities only in the result with the policy.
00:24:13 [W] As you saw in the image Center 7 shows the 600 but abilities without policy, but it would be only seven with the policy.
00:24:25 [W] policy. Let's is not always better. You have to chew on your policy according to the requirement in your organization.
00:24:31 [W] At last let me explain opentracing in kubernetes.
00:24:41 [W] This technique can be applied to any scanner.
00:24:47 [W] But as proof of concept, I developed kubernative operator called tribby enforcer it works as custom controller to scan the image in other words and automation controller
00:24:55 [W] Mesh I use that tries to deploy.
00:25:02 [W] Let's take a look at the architecture. At first. I user registers an image name. They want to deploy other custom resource to reinforce our watches the custom Resource as custom
00:25:13 [W] And sketches the image name then. It sends the image name to trivia server for vulnerability scanning to be serverless turns a result and finally to reinforce
00:25:30 [W] Customer is so sweet. Those vulnerabilities the Scout has art of the image must exist before you try to deploy it.
00:25:40 [W] Besides a user needs to upload their policy to configure Kuma.
00:26:03 [W] and three and four circles Opa service through rest API
00:26:09 [W] when the user is trying to deploy the image kublr this API sends Adam show review to trivia in Corsa and the request contains image name to reinforce our retrieves a custom resource that matches the image name
00:26:26 [W] Result of the vulnerabilities if there's no scar result.
00:26:33 [W] It rejects the image immediately then it sends a band abilities to Opera.
00:26:37 [W] And opa a battery that stores but abilities if one of them violates the policy it returns deny response if there is no bun ability by writing the policy to be enforcer allows the deploy of the
00:26:53 [W] All right, so I'll demonstrate how to reinforce our works with open position to in the kubernative cross stirrer and prevents a bundle image from being deployed at worst.
00:27:10 [W] I'm checking pots in the default namespace.
00:27:12 [W] is no resource and checking the 3B and closer system.
00:27:18 [W] So we'll tribute in full-size deploy.
00:27:26 [W] It works as custom control Rural and admission control rod and also checking though by name space.
00:27:34 [W] You can see one point. It includes two containers.
00:27:38 [W] Why is the OPA service and the other one is could management to Road Rego fire from copy Kuma to Opa service.
00:27:43 [W] Okay, let's check the car come pick them up.
00:27:51 [W] But in the open namespace.
00:27:52 [W] So you can see the one Radio Flyer including helper functions.
00:28:02 [W] This drill fire is deployed by default from by 3 p.m. For sir.
00:28:05 [W] Let's check the content of this ramp while function.
00:28:17 [W] Okay as you can see.
00:28:18 [W] Come pick them up get home, but in the open namespace.
00:28:24 [W] So you can see the one Radio Flyer including helper functions.
00:28:25 [W] This dragon fire is deployed by default from by 3 p.m. For sir.
00:28:26 [W] Let's check the content of this rig while functions.
00:28:26 [W] Okay, as you can see.
00:28:27 [W] This Lego fire provides a helper function Reich pass cbs's vector-based three combating cyber suspect of string to the object.
00:28:29 [W] Okay, you can import this package and calls these fractions.
00:28:35 [W] Okay.
00:28:39 [W] Next you can see the same poor see I used in the previous demo example Rego, it ignores some packages and civilities and some other rooms as well.
00:28:55 [W] You can reuse the same policy in kubernative integration to make use of it.
00:29:00 [W] You have to deploy it as the computer map so rats running create.
00:29:06 [W] Actually be from five example Rego and them space Opa. Okay, create it.
00:29:17 [W] All right. Let's check the comic map.
00:29:23 [W] Okay, you can see the Trevi copy them up.
00:29:30 [W] fire is uploaded to config Mark and load it into Opa subjects through crib management.
00:29:35 [W] in kubernative integration, you need to define the package kubernative parsec dating because three and four circulates it so let's define a policy where before Rego
00:29:51 [W] Let's define a policy where before regel package name must be kubernative.
00:29:54 [W] But it is 18 3 B and import data 3B.
00:30:04 [W] This is what we upload it to just before also the there must be denied Roo.
00:30:13 [W] But we already have the logic to evaluate the vulnerabilities.
00:30:19 [W] In tribute to the ignore so we can just call the important rule here to talk to the didn't ignore.
00:30:30 [W] But the ignore means you can accept the wrist while the knives that you cannot accept the risk. So we need a not you can Define the message. So for example their image
00:30:47 [W] ignore
00:30:47 [W] but that you know are means you can accept the risk while denies that you cannot accept the risk. So we need a not you can Define the message. So for example the image
00:30:49 [W] Okay, that's it.
00:30:53 [W] And also we have to approach this red wire to come pick them up with compete with the name of web Circ.
00:31:07 [W] from five and Opening space
00:31:16 [W] Okay, so there are three config map.
00:31:23 [W] Open in space and website look import stripping also three inputs to be helper functions. Okay.
00:31:35 [W] We completed the preparation of major Shaw ranks.
00:31:45 [W] So let me try to deploy nginx Mage and checks 1.18.
00:31:53 [W] it was rejected because there is no scan result for this image.
00:31:58 [W] This is be corals.
00:32:02 [W] So we've never had it custom resource with this image name. So there is no scar result in the cluster.
00:32:08 [W] Okay, so we need to add custom resource including this image name.
00:32:16 [W] Jack's not Yammer has kind image of an ability. So this is a custom resource.
00:32:27 [W] The name is nginx and image name is nginx, 1.18. So before uploading let's check in with
00:32:38 [W] customary sauce
00:32:40 [W] Okay, so there's no resources.
00:32:44 [W] So let's up.
00:32:47 [W] Let's add this custom resource.
00:32:49 [W] And checks.
00:32:55 [W] Okay, so we can see the nginx customary sauce and to reinforce our watches this custom resource and it detects a change. So now to be enforced our scans the image of
00:33:08 [W] And check so okay. So yeah, we can see the nginx customary sauce.
00:33:09 [W] And to reinforce our watches this custom resource and it detects a change.
00:33:10 [W] So now to be enforced our scans the image of nginx, 1.2 18 and update their vulnerabilities.
00:33:13 [W] Okay, maybe it's already finished H bar, please.
00:33:23 [W] So you can see the labels namespace registry repository and tag also, you can see the status field. It includes vulnerabilities.
00:33:38 [W] You can see so there are vulnerabilities of this image.
00:33:47 [W] example the package name apt and civility role and dependability ID CBE 2011 3374
00:33:59 [W] Okay.
00:34:04 [W] Now we have the scan result of nginx 1.18.
00:34:14 [W] So let's try to deploy this image. Again. This is going to roll around and Jack's image in Jack's 1.18.
00:34:21 [W] But the still failed because this image has a high severity vulnerability and you know, this rag of wire doesn't allow high security vulnerability.
00:34:33 [W] quality of mouth
00:34:40 [W] to Roi security
00:34:44 [W] Okay.
00:34:46 [W] so here
00:34:48 [W] I'm adding the ice ability.
00:34:54 [W] Okay. So after editing this profile you could management roles this Rego file to apis are bees.
00:35:07 [W] So this the price should we succeeded in GX DX 1.18?
00:35:13 [W] Okay, create it.
00:35:18 [W] So now we confirmed that it works properly with open policy agent.
00:35:32 [W] If you use harbor the containerd registry to be infrastructure and clearly Harbor to fetch but abilities over the image because Harbor supports images stunning in the registry in that case. You don't need to add a
00:35:39 [W] pretty scanning
00:35:41 [W] So I have the demo mode by integration with Harlow register.
00:35:50 [W] So now we have Harbor deployed in the kubernative cross them and the brush alone is 201.
00:35:57 [W] So it's a registered version and then the domain name is Cora how the domain so there are some images on this project Library.
00:36:14 [W] So right bloody nginx and the library Alpine. So let's have a look at nginx.
00:36:19 [W] It has only one tag 1.18 and it has some vulnerabilities including High stability.
00:36:25 [W] Bring me the different policy than the one we just used with three be because Harbor has a different format of the star result.
00:36:35 [W] So defining the policy for harder.
00:36:39 [W] It's a package name us to be kubernetes, but dating Harbor and includes deny with the message in this example. It just denies upon abilities of high and collect cars ability.
00:36:51 [W] And moved through means policy used in the previous demo so you can see the only one Rebel file. And so we have to upload the policy to Kovac bump. This force is also Roadie to Opa zombies
00:37:07 [W] from fire Harbor Islands at Rego openebs space
00:37:12 [W] Okay, created and the load it to the river. It'll find the poor see over Harbor and copied map.
00:37:20 [W] So let's try deploying the image in the harbor registry.
00:37:27 [W] So in this case, I'm using the corer harbor domains Rush Library / nginx 1.18.
00:37:37 [W] But it was rejected because as you know, this image has a high stability but nobility so the this image violates the policy so modify the Porsche to allow
00:37:53 [W] But it was rejected because as you know, this image has a high stability but nobility so the this image violates the policy so modify the Porsche to allow
00:37:55 [W] Okay. So let's remove this civility High stability from the policy.
00:38:03 [W] And try to the try to deploy the image again around nginx image core. How about the main library and Jack's mom Point 18?
00:38:20 [W] So the pro is supposed to be allowed.
00:38:24 [W] So as you can see the image has been created.
00:38:30 [W] So you can operate image of Chiron throughout the development life cycle in local development and continuous integration. You can run three be CLI with - - ignore a policy option.
00:38:46 [W] Then to be enforced I can be used in the kubernative crustal to reject deployments image with critical vulnerabilities.
00:38:55 [W] The important thing is that you can share the same policy across the whole process.
00:39:03 [W] Note that they are still experimental features and not stable.
00:39:10 [W] What I wanted to get across in this presentation is that we should Define custom foresee for vulnerability handling based on your organization's risk acceptance.
00:39:24 [W] And proof of concept as opentracing with stripping.
00:39:30 [W] In those PLC you can take advantage of the same orbit policies throughout the development lifecycle. That's it.
00:39:40 [W] Thank you for your attention.
00:39:42 [W] There are a lot of software vulnerabilities in the world.
00:39:56 [W] Okay. So the time is the answer questions.
00:40:07 [W] Okay, so let me pick up some questions.
00:40:11 [W] Okay, at first from Rhea, I've got collect button bendability database. So basically the app bar provides two types of the product. So a trust open source and the other
00:40:22 [W] So as for commercial product I've got corrected by negative information from the commercial database. But as for open source, we are using National openebs Database and BD for vulnerability detail and so
00:40:38 [W] Our security advisories from vendors such as red hat Debian Ubuntu Amazon for Bon Appetit addiction because the panda has a backboard fixes.
00:40:54 [W] So the the fixed version of Upstream for the open source and fix the Belgium Observer Bender different so we have to use the security advisories from Bender.
00:41:08 [W] Okay. So the next question is does three be expect Opa to be rounds?
00:41:18 [W] All right three or is it embedded in the trivia executable?
00:41:19 [W] Okay. So babe. I provide I did two Demos in the presentation and across I showed integration with strimzi CLI.
00:41:33 [W] So in such demo the Opera is embedded into 3B binary so you don't have to run Opa operator e so trippy Imports go Library.
00:41:38 [W] Opa but second one that's for the kubernative admission control Opa service is wrong separate three and to be enforced a course of a
00:41:53 [W] VI so it's a separately.
00:41:58 [W] Okay.
00:42:01 [W] Okay. So the next question.
00:42:03 [W] Is that a dynamic analysis dynatrace analysis tool?
00:42:24 [W] C which is the running containerd, but
00:42:32 [W] Should I use the phone?
00:43:06 [W] three
00:43:16 [W] next question is
00:43:28 [W] Is the right example Rebel on GitHub?
00:43:33 [W] Of so, I have to mute.
00:43:36 [W] Okay, it's example right on the top.
00:43:39 [W] Yes.
00:43:40 [W] So we have example rate of fire in the ecosystem distribute and across Securities rushed three and four-star on GitHub so you can find it.
00:43:55 [W] So the next question is is there any depository with the available?
00:44:16 [W] Yes, right. So the first first demo the detail is described in the readme, of course security 3D and second the demo is
00:44:23 [W] us to being for sale on GitHub, but as I said, it's a proof of concept so experimental project so it doesn't have enough options and enough pictures, but if the many users are interested in the project, maybe
00:44:38 [W] I will maintain the project more.
00:44:41 [W] Okay, so maybe the time is over that let me answer one more question.
00:44:53 [W] All right. Okay this one how would we update the to be database in exact environment?
00:45:02 [W] Yeah. So the database is uploaded on GitHub release every 12 hours.
00:45:06 [W] So you have to download it.
00:45:07 [W] It's just a single file it because we are using the board to be be single file database.
00:45:13 [W] You have to sync it with your suburb and you can run three be in there are gaps to environment as well.
00:45:27 [W] All right, so, I think the time is over. So thank you for thank you for taking your time to join my session, and please feel free to jump into the recomposition in the scratch Channel. Thank you.

Where Are Your Images Running? Stop Worrying and Start Encrypting!: OCPJ-9303 - events@cncf.io - Wednesday, August 19, 2020 6:55 AM - 57 minutes

Participant: wordly [W] English (US)

Transcription for wordly [W]

00:04:45 [W] Hi, my name is Brandon and I'm here today with my co-speaker how he got to talk to you about a problem that would have been easy to answer to 30 years ago, which is where's my workloads running and the answer would be simple it would be
00:05:01 [W] No, it's a room. It's in the room on the 7th Floor something.
00:05:05 [W] But today when asked about where my workload is, we say the cloud with virtualization containerization and layers of abstraction coming into place the answer to this is not a straightforward anymore.
00:05:20 [W] Where's my workload? After all the computer has to this somewhere both logically and physically in the country in the room in the server in Battle.
00:05:32 [W] But why does this matter?
00:05:35 [W] There are several reasons why this would matter first there is if our container contains confidential code trade secrets, for example top secret trading orbitary algorithms.
00:05:51 [W] We wouldn't want our code to be excellently run in data centers.
00:05:55 [W] We don't own, you know us even in someone's basement.
00:05:59 [W] For example, the second is for compliance reasons and highly regulated Industries like Financial Federal and Healthcare.
00:06:05 [W] For these industries, they go even a step further.
00:06:10 [W] They not only require their containerd workloads to be tied to a physical location, but they also want to ensure that the underlying technologies that got the machine is a tested and approved.
00:06:16 [W] And finally the losses for things such as export control or to enforce other legal regulation.
00:06:24 [W] So this is exactly the problem.
00:06:29 [W] To a specific location and this is also called execution geofencing.
00:06:37 [W] And by the end of the talk today, we're going to learn how to do this with containers.
00:06:43 [W] Our claim is containerd image and Corruption plus Key Management equals execution geofencing and we will show this
00:06:52 [W] so to start exploring that we're going to first look at one of the underlying Technologies, which is container image and Corruption.
00:07:01 [W] So what is containerd image encryption?
00:07:08 [W] So this is an effort that started almost two years ago and basically allows ability to encrypt a container image.
00:07:14 [W] The process of this is fairly simple on the left hand side during the build stage. We add an encrypted slept and during the runtime. We add a decrypt step so between build and runtime the container remains encrypted.
00:07:29 [W] This means that the contents of the image remains confidential over the network or even in the registry.
00:07:36 [W] So in a nutshell this technology enables us to encrypt the containerd image so that it's only the credible by a particular key X and this means that we can retain the confidentiality of the image. Even if for example, the registry is hacked.
00:07:54 [W] Feature that's available today across various parts of the ecosystem like Builder Scorpio. Containerd T.
00:08:02 [W] cryo and the docker registry and we'll be showing some of this in the demos today.
00:08:08 [W] So before we go ahead let's go through a quick asymmetric crypto primer to see how this works.
00:08:17 [W] So in asymmetric cryptography such as RSA views keepass made out of public portion, which is not secret and can be published and a private portion, which is kept secret.
00:08:30 [W] We can encrypt a piece of data over here on the left with a public key to get the encrypted Cipher text in red.
00:08:39 [W] And then the ciphertext can then be decrypted by the private key, which only the owner has to obtain the plain text.
00:08:47 [W] So now let's go through an example of encrypting image so over here we have errors and we say we want to encrypt an image for Ellis. So let's go to the flow here.
00:08:59 [W] So why it is first is to do is to generate an RSA key pair and then publish the public portion of a key.
00:09:08 [W] So given the key we can then go ahead and take our containerd image and encrypted with the public key.
00:09:18 [W] We then take this encrypted image and push it to the registry like Docker hub.
00:09:22 [W] Will be a this is able to pull the anchor of the image. And because only she has access to the private key and no one else only she is able to successfully decrypt the image and run the container.
00:09:39 [W] So let's go ahead and take a quick look at what the demo of this looks like.
00:09:45 [W] All right. So in the demo, we just saw how we can create an encrypted image for Alice and how she was able to run it on the workstation.
00:13:15 [W] So next question at a test is how do I take this image and run it on my kubernative cluster. So let's take a look at that.
00:13:24 [W] So how encrypted container images work with kubernative cluster is true. They contain the runtime such as cryo and containerd E these runtime service possible for putting decrypting and unpacking the image and also for the runtime should be
00:13:39 [W] All right. So in the demo, we just saw how we can create an encrypted image for Alice and how she was able to run it on her Workstation.
00:13:42 [W] So next question ever says is how do I take this image and run it on my kubernative cluster. So let's take a look at that.
00:13:43 [W] so how encrypted container images work with kubernetes cluster is should they contain a runtime such as cryo and containerd E these runtime service possible for putting decrypting and unpacking the image and also for the runtime should be
00:13:48 [W] The image stay like as need to have access to the key material.
00:13:49 [W] So today this can be done by passing a tree to file system. And for example in cryo the default directory for this is at the cry on keys.
00:13:56 [W] So to help distribute the key to the container runtime is more easily.
00:14:07 [W] We will make use of a key thinking operator that we've written. This is open source, and is also available on operator hub.
00:14:11 [W] What the keys and can operate a does is allows the ability to take a kubernative secret as a key and distributed to the container runtimes.
00:14:27 [W] So others can easily create a decryption Key by creating a secret with the specific type equals two key.
00:14:29 [W] So let's take a look at this.
00:14:32 [W] Awesome. So let's recap what we've kind of seen in the past two demos.
00:17:05 [W] So we start off by encrypting containerd image. That was only the credible but Alice's private key in the first demo and the first demo we saw that because at this has a private key accessible on her local workstation.
00:17:22 [W] Decrypt it and therefore with the Cortana work with that was encrypted was only decrypt herbal or other source workstation because the key was only available there.
00:17:33 [W] So in the second example, we went ahead and added as use the operator to make her private key accessible to the notes in the communities cluster. So in the middle here, we see that Alice's private key is not accessible on both homework station and kubelet he's cluster.
00:17:50 [W] So this meant that the container will glow was down decrypt herbal and executable on both her workstation and asses kubernative cluster.
00:17:59 [W] So if we take a step back and in this scenario, so we see that you know, Alice has been this person that has been generating the keys.
00:18:10 [W] She's been making them available to different entities.
00:18:16 [W] What as is essentially doing is menu key measurement right? She's acting as volt but just a person that's generating keys and putting in the correct locations.
00:18:23 [W] So we generalize this right at has his key measure and what does key measurement do for us Sookie management says that a certain key X for example in this case X is Alice's private key is only accessible by a set of
00:18:39 [W] E where e in this case is as as book station and as as kubernative cluster.
00:18:46 [W] So we take the definition of on the image encryption that we got from earlier. We get that containerd image encryption allows us to encrypt a containerd workloads.
00:19:01 [W] So there is only decrypt the ball by a particular key X key measurement says I can say a key X is only accessible by entities e and so we put this together we can get the statement that says a container will glue it is only decrypt herbal
00:19:13 [W] The Entity see
00:19:15 [W] And this is exactly your fencing because if entities e may be a set of workers in a particular location that would be able to allow us to do a fancy execution.
00:19:28 [W] Awesome.
00:19:31 [W] So now that we have this capability how show will show you how we can use this and price scenario?
00:19:36 [W] Thanks Brandon. So now extending on what Brandon said that you have a key management and you have image encryption. So let's let's get to the actual scenario where I have like a u.s.
00:19:55 [W] Cluster here in red and the cluster in European union and I want to make sure that the content images that I am creating are only able to run on specific cluster.
00:20:09 [W] For example, if I create a container image that I want to be able to show you will too.
00:20:11 [W] Sure that it only runs on European Union cluster and nowhere else.
00:20:15 [W] So what we can do here is we can use image encryption and Key Management in combination such that the the images will be able to run on appropriate cluster.
00:20:28 [W] So to elaborate the point further if you if you create image if you can keep the image and use the proper Key Management where cluster gets authenticator the the keys are only on.
00:20:40 [W] Caption, so let's let's get to the actual scenario where I have like a u.s.
00:20:44 [W] Cluster here in red and then a cluster in European union and I want to make sure that the content images that I'm creating are only able to run on specific cluster.
00:20:45 [W] example, if I create a containerd image that I want to be able to show able to make sure that it only runs on European Union cluster and nowhere else. So what we can do here is you can use image encryption.
00:20:48 [W] And the key management in combination such that the the images will be able to run on appropriate cluster.
00:20:50 [W] so to elaborate the point further if you if you create image, if you can keep the image and use the proper Key Management where cluster gets authenticator the the keys are only a provision to the cluster if it gets properly authenticated
00:20:55 [W] Key Management only the in this case. You can see the cluster in EU cluster.
00:20:56 [W] The EU cluster will get the keys and the u.s. Cluster will not be able to get the required Keys.
00:20:58 [W] Let's let's jump into demo to see this in live in action.
00:21:00 [W] All right.
00:28:09 [W] Thanks hashicorp.
00:28:11 [W] So before we end up to talk, I'd like to address one aspect of key measurement that we talked about earlier.
00:28:21 [W] Sure, that those entities can access those keys and we today rely a lot on secure process or Reliance on the transit administrator.
00:28:38 [W] However, this introduces a lot of human error, and I think that this is an area that we can do a little bit better.
00:28:42 [W] So in research today, we are exploring how to do this to do something even more which is to tie it to how we would have trust like a TPM and even go ahead and have the ability to attach the foam where all the way up to the operating system level.
00:28:59 [W] So this way not only do you have time to a particular set of hardware.
00:29:09 [W] You also are able to know what is exactly running in the underlying seccomp for container.
00:29:11 [W] So there are couple open source technologies that do this today.
00:29:21 [W] There's key lime, which is developed but mainly by red hat and then we have Intel data center secure libraries also known as I cycle which is the set of libraries that allow you to perform at the station
00:29:31 [W] Ability to attach the foam where all the way up to the operating system level.
00:29:32 [W] So this way not only do you have time to a particular set of Hardware. You also are able to know what is exactly running in the underlying stackrox your container.
00:29:33 [W] So there are couple open source technologies that do this today.
00:29:34 [W] That's key lime, which is developed but mainly by red hat and then we have Intel data center secure libraries also known as I Seco, which is a set of libraries that allow you to provide cessation and
00:29:36 [W] reports back
00:29:36 [W] So in addition that the spin the publication by this and this is something that we collaborated on with them and this article talks about how you use these types of Technologies together with the containerd platform to bootstrap.
00:29:51 [W] Trust all the way from the hardware bit of trust to the containers.
00:29:54 [W] So this is a piece of work that is pretty interesting in itself.
00:30:00 [W] is it kind of is a topic in itself?
00:30:04 [W] So we don't have time to really go in depth, but this is something that we are constantly looking at when we feel like more people to engage on this topic.
00:30:12 [W] So to summarize we talked about the question of who am I containerd surrounding we talked about why in subsidiaries is can be important and how we can achieve this through encrypted container images as well as Key Management.
00:30:29 [W] You how to use encrypted container images on various components and parts of the ecosystem like containerd the aquarium Builder and dr.
00:30:40 [W] Distribution, and lastly we touched a little bit on talking about highly regulated Industries and high Assurance.
00:30:49 [W] How do we kind of get to the next step in being able to put trust into our container platform?
00:30:59 [W] And this is something that we want to continuously work on and we would
00:31:01 [W] Like to be engaged with this, so we have a repository here that we we've created so that people can join in the discussion. So please do feel free to come in and get your bus.
00:31:10 [W] So that's all we had for today.
00:31:15 [W] Thank you very much quick shout out. Also to Stefan Phil who did a lot of work during the initial stages of the feature and also with the other collaborators for all tikv taner the cryo and the
00:31:28 [W] So with that I'd like to open up the questions and also there are links to various components that we talked about in the slides if you can download them.
00:31:41 [W] Thank you.
00:31:43 [W] Will can you hear me?
00:32:20 [W] I think I have sorry. I was on mute.
00:32:24 [W] So most images be decrypted in order for static One.
00:32:28 [W] Liberty scandals is a question from Casper Kuma Casper Kramer about if you need to use the scanning tools, like trivia or Claire, do you need to decrypt any S. I mean survey it will work is you you can
00:32:39 [W] You can have a multiple recipients.
00:32:46 [W] So let's say I encrypt the image that I need to run a my cluster and then I can add the private key that I will associate with the Claire for example, so when the when you know, your bill pipeline you will be able the
00:32:57 [W] We'll be able to decrypt the image do your scanning and now it can go ahead with that.
00:33:08 [W] So that way you don't have to disclose this image to everyone except you are instances where you're running this canning.
00:33:16 [W] So that's question from Kashmir.
00:33:17 [W] I think you have another one more question.
00:33:18 [W] now
00:33:21 [W] our the Manifest and config files of the image also accepted a question from Alexandro. I know right now the the first implementation we have layers of the images that are encrypted not the Manifest itself
00:33:40 [W] Okay, cool.
00:33:42 [W] I'm sorry.
00:33:43 [W] I had some technical difficulties.
00:33:50 [W] So I just want to kind of add a little bit more into what hashicorp says about the image scanning.
00:33:54 [W] So one way that he mentioned was you have a key. So something that we're looking at is you can encrypt so those questions in the Q&A as well on do I need to head different private
00:34:09 [W] Something that we're looking at is you can encrypt so those question in the Q&A as well on do I need to head different private keys to be able to Caillou's
00:34:13 [W] To be able to carry yourself and private keys for different machines. If I want to can does images image only type to a single private key and the answers you can use different private keys.
00:34:25 [W] You can encrypt an image from multiple using multiple public keys.
00:34:36 [W] And this is kind of like an approach that we are thinking about in terms of how one will use this for scanning service. So for example, a service activity or class
00:34:42 [W] Something would expose a public key. And if you trust the service, you will encrypt your image both for your Hardware as well as for the for the scanning services that you trust.
00:34:55 [W] It does a couple other approaches is so what the image encryption is also done on a layer level.
00:35:11 [W] So what you could do is for example, if you are confidential code is only a small portion of the entire inventory because we serve the operating system because of the Middle where you could also leave your middle
00:35:18 [W] Produces some layers decrypted because the snow of leadership material that and only encrypt your top most layer.
00:35:30 [W] So that's another way of doing it.
00:35:35 [W] And if you're using things like opens Gap or things that can scan locally another thing that we recommend if you're already in the high ocean scenario and you don't trust anyone including external providers, you want to do your own scanning
00:35:45 [W] Um, you could do you could do this by doing the scanning before sending before uploading the images to the registry.
00:35:57 [W] Yeah.
00:36:02 [W] We have a question five fully believes about what is the benefit of using a symmetric Keys here instead of symmetric key. So the symmetric Keys as we do use symmetry keys to encrypt the layers.
00:36:18 [W] We just wrap them in a signatory keys so that you can have recipients for that.
00:36:24 [W] So badly want to adding that. The I think is a pretty well we use both of them. We then go to the suspect over here, but if you if you
00:36:34 [W] go to the we have a couple links and the last slide some of them if you want download the presentation, that's a couple links there the speckled contain more detail about how we use both symmetric for the data in this we're using asymmetric
00:36:48 [W] He rapping in keep to the rear now.
00:36:54 [W] We know it's a little bit darker Hub.
00:36:59 [W] There's a question whether it's it's available on our Zoo container registry.
00:37:00 [W] I haven't checked if it's available.
00:37:03 [W] I will assume I entered it I know is available IBM containerd registry.
00:37:08 [W] Yeah, that's really when I yeah.
00:37:15 [W] I've been continuously Docker has supports it. And as soon as any other provider will upgrade to the latest version of the registry distribution.
00:37:20 [W] They will get the support because the code is Upstream. Anyway, I think we tested this with battery if using Docker distribution, it's we were testing this with two point seven point one.
00:37:33 [W] So I think anything above 2.7 should be fine.
00:37:35 [W] Yeah.
00:37:38 [W] I'm just going with the questions.
00:37:42 [W] Okay, that's a question for Alejandro about other manufacturing config files also encrypted.
00:37:56 [W] So right now only the layers are being encrypted.
00:38:01 [W] We had a lot of conversations about encrypting the context as well.
00:38:05 [W] It seems like that some technical challenges in terms of how a lot of the tooling is written where the code paths are not.
00:38:13 [W] I'm just going with the questions.
00:38:18 [W] Okay, that's a question for Alejandro about other manufacturing config files also encrypted.
00:38:19 [W] So right now only the layers are being encrypted.
00:38:20 [W] We had a lot of conversations about encrypting the context as well.
00:38:20 [W] It seems like that some technical challenges in terms of how a lot of the tooling is written where the code paths are not.
00:38:22 [W] And all kind of similar to the way a so we started off with layers conflicts conflicts are kind of on the roadmap manifest.
00:38:29 [W] We weren't we couldn't really figure out the use case for manifest conflict.
00:38:33 [W] We definitely think it should be encrypted what we are.
00:38:37 [W] What the next step for this is where actually proposing this encryption scheme and the OCA artifacts it level.
00:38:50 [W] So what this would mean would be you could encrypt any oci media type, right? So you could have if you had a very fast you could have layers and
00:39:00 [W] Couldn't really figure out the use case for manifest conflict. We definitely think it should be encrypted what we are.
00:39:02 [W] What the next step for this is where actually proposing this encryption scheme and the OCR artifacts that level so what this would mean would be you could encrypt any or ci/cd.
00:39:03 [W] Um if Dad knew or see I'm either types, it would just be a suffix.
00:39:16 [W] So if you look at the media type of the spec if for the layers you have liked our the gzip and what we're doing is you're just adding a plus encrypted suffix.
00:39:20 [W] And so what this is is just tells it that this blob is encrypted that kind of answer the question Ranjit Arroyo has is there any signature details in image manifest that can be read by admission controller and when you if you can
00:39:31 [W] fetch the image and if you read the layers, the layers will be tagged as not our jerseys it'll be tagged and then Inc will be at the end of it.
00:39:46 [W] Yeah, and and I I would say that this will be used in tandem with any science Solutions like the upper content trust. Somebody has simple signing just because we are only the encryptions of
00:39:56 [W] On the Integrity of the the granular level blobs like the layers, but in terms of like the anti manifest in the provenance, we're not really looking at that.
00:40:08 [W] So I would say both can be used together.
00:40:12 [W] Just going on more questions. Yeah.
00:40:21 [W] Okay, looks like bad time.
00:40:28 [W] Oh, yeah.
00:40:30 [W] Yeah, I since I well time.
00:40:31 [W] Wow, I guess we'll be outside if there are any more questions and then we can go from there.
00:40:37 [W] ep.

Tutorial: Kata Containers Performance Evaluation and Optimization on Arm64: QCBZ-3821 - events@cncf.io - Thursday, November 19, 2020 2:57 PM - 32 minutes

Participant: wordly [W] English (US)

Transcription for wordly [W]

00:00:00 [W] Hello, everyone.
00:00:01 [W] Good morning.
00:00:01 [W] Good afternoon, and good evening.
00:00:05 [W] Thanks for attending my topic today.
00:00:50 [W] Hello, everyone.
00:00:51 [W] Good morning.
00:00:51 [W] Good afternoon, and good evening.
00:00:55 [W] Thanks for attending my topic today today. My talk is about Keda containers performance evaluation and optimization
00:02:31 [W] Duration and optimization of 64. My name is Justin.
00:02:37 [W] who?
00:02:38 [W] I'm mailing foxes Fox on the container virtualization technology on 64.
00:02:53 [W] Here is today's agenda personally. I will give you a broad brief introduction about what is cut container.
00:03:07 [W] Then I will give you the status update.
00:03:11 [W] I'm 64.
00:03:12 [W] That is what we have done so far.
00:03:19 [W] Then I will go through the performance evaluation.
00:03:24 [W] from several aspects
00:03:29 [W] At Last I will introduce to the two simple uses user stories in real cases
00:03:47 [W] If you have used the container, maybe you have so talk about the question how to make cut the container more secure.
00:04:00 [W] Such as make you can mount the root affairs with read-only mode. You can use a seed in X and appr Marzi.
00:04:30 [W] And you get more performance overhead.
00:04:36 [W] So actually the color container is a combination or trade-off between the virtual machine and container.
00:04:55 [W] It is compatible with oci wrong times back there for Works seamlessly with the doc engine besides it also supports
00:05:10 [W] I think the virtual machine and container.
00:05:08 [W] It is compatible with oci wrong time spec. Therefore Works seamlessly with the doc engine besides. It's also supposed
00:05:36 [W] See, I threw the cri-o and this here is your containerd T. In other words, you can choose transparently choose select between the
00:05:52 [W] the cut container
00:05:58 [W] the this is the Kata containers architecture design flow chart.
00:06:08 [W] Kurt agent is a process around me in the guests as as you provider for managing the the containers and percent surrounding within those containers.
00:06:26 [W] The Kata proxy offers access to the VM cutter agent to both shame and Keda runtime its main role is to Route all the i/os
00:06:41 [W] tears
00:06:44 [W] the Kata prophecy offers access to the VM cutter agent to both shame and Keda runtime its main role is to Route all the
00:07:13 [W] the signals
00:07:15 [W] it connects to the cutter agent on a Unix domain socket I restock.
00:07:24 [W] Cut the process we use yellow marks to Multiplex grpc connections.
00:07:30 [W] its connection.
00:07:36 [W] The same process wrongs in the in the host environment handling standard I/O and the signals on behalf of
00:07:51 [W] which is inside guest
00:07:56 [W] but
00:07:59 [W] after the the Kata containerd 2.0 some parts of this project will be changed a little bit.
00:08:06 [W] So this is what what were the new items in Qatar 2.0?
00:08:18 [W] for example CIA Dia shim V2
00:08:25 [W] It's a reduce reduce and many many parts of the architecture design flow chart and
00:08:42 [W] To replaced Golan agent.
00:08:47 [W] And it's used a grpc.
00:08:50 [W] is that tiny grpc implementation to replace the original grpc library to use a resource like to replace the virtual cri-o
00:09:07 [W] original grpc library to Savi sock to replace the virtual CEO Rio
00:09:07 [W] and 34 to the cloud hypervisor will replace the two mu by pointer also supposed to get
00:09:23 [W] Two new lines are also supposed to get stats cgroup V2.
00:09:38 [W] And what's the status of container?
00:09:44 [W] I'm 64.
00:09:46 [W] Totally speaking. It can wrong can be wrong smoothly on 64.
00:09:56 [W] UK e you can install the kind of container I'm seeing the four by two ways
00:10:05 [W] First day is the step install and then secondly, you can build it from the source code.
00:10:17 [W] To run the credit containerd you can use the Ctrl command line.
00:10:23 [W] here is the examples you can use the CTI image portal poor the container image and wrong the simple application.
00:10:39 [W] I using the city are wrong.
00:10:45 [W] Also, you can run on a Raspberry Pi for platform with minor changes.
00:11:03 [W] Here is the feature comparison result between arm 64 and the exit is x86 as for the hypervisor support x86 supports
00:11:18 [W] firecracker class hypervisor and April, but Akram is not supported armed 64 the cut container will use
00:11:20 [W] Well, let's the hypervisor to create a medium device and then mounted as a guest who defends it can speed
00:11:29 [W] Put time and shared guest route offense.
00:11:40 [W] And virtually wife Elsa feature is used in the container route offense.
00:11:54 [W] Which I which I will introduce the in later slides.
00:12:00 [W] The answer is tick mark forearm City for Kuma. Here is the Upstream Camille had supported this future, but we also need some time to introduce the
00:12:16 [W] I'm 64 for Kirk container.
00:12:21 [W] next
00:12:24 [W] VM template is a useful technology to speed up the boot time.
00:12:34 [W] This feature is supported on posts.
00:12:38 [W] And also the rest of the agent is supported books.
00:12:45 [W] Remember how to blog we have string has supported our arms City for but we were introduced in the future the
00:13:01 [W] Apply that someone had some posted a patch serious to supported in accumulate in both kill you and Kill Colonel Community, but I
00:13:08 [W] but yet also for the next tikv, I'm and KVM feature 64 KB M the community has
00:13:15 [W] It's one huge one big serious and after that after the community merge them we can use we can introduce the into 64 for
00:13:34 [W] The what's wrong with this is a shared file system that lets virtual machine access a directory Tree on the host unlike the
00:13:49 [W] King approaches it is designed to offer local file system semantics and the performance
00:13:59 [W] the low level of the virtual address is a effuse implementation to refuse the protocol is not based on the network or toggle.
00:14:14 [W] It needs more faster faster performance and better / / 6 semantics cop abilities.
00:14:28 [W] There is a independent which iOS demo process more secure and needed to maintain the device mapper.
00:14:47 [W] And there is a text mode you can whisk this in it with this text mode enabled the host and the guest can
00:15:02 [W] memory and improve the performance
00:15:05 [W] and you can also bypass the guests per page cache avoided an accessory of EMF exit.
00:15:17 [W] and the the backhand is in user space, which is
00:15:25 [W] convenient for for the user to further two
00:15:36 [W] But we once observed that the what-ifs will increase the system system level memory footprint because you know it to use
00:15:51 [W] it will increase the system system level memory footprint because you know it to use additional share the pages which
00:15:54 [W] Which this allows the KSM to merge the pages?
00:16:07 [W] The in the internal tests showed that it will significant significantly improve the file system performance in Qatar compared with virtual IP.
00:16:23 [W] From this chart we use the file reader right test the data improves increase about 10 to 20 times
00:16:39 [W] the cases
00:16:45 [W] this is the we have to done for the functional features the development firstly we enable the runtime and the rust agent.
00:17:01 [W] We maintained the CI a-- testing subsystem and we enable the fire cracker and even the contact whiter 64.
00:17:00 [W] Surely we can't have either is another individual independent project Ripple we develop in able to help either
00:17:14 [W] Develop enable the help of the from scratch.
00:17:20 [W] We also finished the kubelet integration tests with Qatar container.
00:17:31 [W] There's a to-do list in the future for us to such as the memory and the V CPU hot black and the important next hit virtualization.
00:17:52 [W] So to summarize the performance comparison between different architectures, we choose the some important aspects such as the
00:18:07 [W] the binary closed eyes and the main memory footprint
00:18:16 [W] here is the the hardware or software setup in for the host the ghast accumulate and cutter version.
00:18:34 [W] This is the evaluation for both time. I once started wrong a simple container plication.
00:18:49 [W] you entered the tunnel world and the exhibit at once for 10 to 100 times and then calculate the average route a term for both time
00:19:04 [W] The x-axis is the point time difference to the starting point.
00:19:04 [W] The y-axis is the mini second time unit.
00:19:13 [W] We observed that the most Gap is between the VM started and agent started.
00:19:24 [W] I could have put time and a Kuma boot time.
00:19:30 [W] And the boot I might be a little different between different configuration.
00:19:43 [W] The total boot time of the guest Colonel is not so so so long, but we still find something to optimized we reduced
00:19:58 [W] double time from maybe 117 minutes II 281 many seconds
00:20:03 [W] Another tunable is the ci/cd service, but given that most of the Destroyer enable systemd. We didn't remove food assistant t as
00:20:18 [W] Ci/cd service, but given that most of the Destroyer enable systemd.
00:20:17 [W] We didn't remove food assistant t as I parted from this chart we concluded that the boot time Gap and arm 64 compared with
00:20:33 [W] We concluded that the boot time Gap.
00:20:37 [W] I'm 64 compared with x86 in knots the guest Colonel puta.
00:20:50 [W] This is the two new items.
00:20:54 [W] For example, we disable the pmu initialization if the user doesn't want to use it.
00:21:06 [W] And by default does Cassie scale mode is synchronization mode we can set it to now.
00:21:18 [W] And also we buy the fourth. I'm 64 will create about 30 32 VM, which I ôm iot devices even the user
00:21:34 [W] and use it
00:21:37 [W] we can't disable it by default in the kernel configuration.
00:21:46 [W] There is a one and another way to speed up the Poo time.
00:21:55 [W] There's more aggressive. That is VM template.
00:22:01 [W] VM template is a new feature that enables the new VM creation using a cloning techniques.
00:22:13 [W] when it is enabled the new virtual machine, which machine is created by cloning from a pre created template and they will share
00:22:29 [W] I am initial drama fest kernel and the agent memory in read and read only mode it just a like a process Folk.
00:22:37 [W] It is expected that to me or doesn't write anything to the guest RAM and two virtual machines started.
00:22:49 [W] but it does in I'm 64 Kuma you so there is a very exception of 64 when we enabled
00:23:04 [W] The feature actually the room block dtp will be filled filled into RAM during round room reset incoming case.
00:23:03 [W] Fielding's seems to be not required since all the data have been stored in memory back end.
00:23:03 [W] already
00:23:05 [W] So we we pipe up.
00:23:11 [W] Well, actually we bypass that process and make it make it the VM template enabled. I'm 64.
00:23:33 [W] This is the binary size performance comparison.
00:23:40 [W] Cut our will start start a guest with limited memory or CPU resource hence reducing the binary size code size is a tuning aspect.
00:23:56 [W] From this chart will reduce by undersized for Kata binary about 20 to 30 percent.
00:24:14 [W] Customize the the configuration and stripping the binary binary sighs. The binary sides was reduced by about 20% with
00:24:29 [W] You know we can cut off all the unnecessary device creation by by stripping we can reduce more.
00:24:38 [W] Creation by by stripping we can reduce more 60% but concise.
00:25:00 [W] This is the memory footprint perform for the performance comparison.
00:25:07 [W] You can see from this chart the possible reason why the virtual memory footprint our of Kuma Lon. I'm 64
00:25:24 [W] You can see from this chart the possible reason why the virtual memory footprint our of Kuma Lon.
00:25:35 [W] I'm 64 is bigger than that.
00:25:38 [W] X86 is the firmware devices creation.
00:25:46 [W] There are two P friends devices takes about 128 megabytes.
00:25:56 [W] It's well be created unconditionally.
00:26:06 [W] The resident memory I physical memory.
00:26:11 [W] of I'm 64. The kuma footprint is as much as Eva better than then it x86.
00:26:29 [W] So this is the comparison with out.
00:26:41 [W] This is the recent memory summary for the for the size. Come comparison.
00:26:55 [W] Sorry for the go agent and cutter go wrong time.
00:27:03 [W] process
00:27:04 [W] reason without
00:27:14 [W] this is the research into memory summary for the for the size. Come comparison.
00:27:29 [W] Sorry for the go agent and cutter go wrong time.
00:27:36 [W] princess
00:27:41 [W] the size of two architecture is close or you are the same.
00:27:54 [W] This is the net Food Network throughput.
00:28:04 [W] You know the PBR and cubic different congestion algorithm.
00:28:11 [W] These are to TCP these two different congregation congestion algorithm for the
00:28:27 [W] And cubic different congestion algorithm.
00:28:33 [W] These are to TCP these two different congregation congestion algorithm for the TCP in Colonel.
00:28:48 [W] As 34th, but from the test results shows that in the note at least the in the local and the local lab
00:29:02 [W] It's the BBI has a lower performance.
00:29:05 [W] then the cubic
00:29:10 [W] here is the test result by changing the algorithm.
00:29:16 [W] We we improve we increase the throughput from almost nearly eleven gigabytes to
00:29:32 [W] 15 gigabytes
00:29:38 [W] This is the performance tuning items what we have down enable the VM template the fs Dex and the persistent memory support.
00:29:53 [W] And we changed the algorithm from from PBR to kubek.
00:30:08 [W] These are finally I will introduce the two to user cases You Know by 2 is a dominant Chinese search engine operator.
00:30:22 [W] It's a iCloud by two are cloud is a complex network with huge amount of traffic and the complicate deployment scenarios.
00:30:38 [W] The peak traffic is about 1 billion page page views per day and 50,000 containers for a single tenant.
00:30:52 [W] So by to choose to use a Kata containers after doing extensive research on secure container Technologies.
00:31:03 [W] And determine that Kata containers is a highly secure and a practical containers technology.
00:31:12 [W] 1 billion page page views per day and fifty thousand containers for a single tenant.
00:31:17 [W] So by do choose to use a cutter containers after doing extensive research on secure container Technologies.
00:31:29 [W] And determine that Kata containers is a highly secure and a practical containers technology.
00:31:40 [W] Precise as one of the important Founders and the maintainers Alibaba use uses cut containers in it's easy as we are mental.
00:32:08 [W] It Founders and the maintainers.
00:32:12 [W] Sorry Papa use uses cut containers in it's easy as we are mental instance Plus kubernative.
00:32:29 [W] So that's all for today's presentation is any questions?

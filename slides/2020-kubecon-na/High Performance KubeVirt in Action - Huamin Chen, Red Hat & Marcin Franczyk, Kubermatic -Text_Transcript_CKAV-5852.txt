High Performance KubeVirt in Action: CKAV-5852 - events@cncf.io - Friday, November 20, 2020 4:02 PM - 33 minutes

Participant: wordly [W] English (US)

Transcription for wordly [W]

00:00:00 [W] Greetings that he saw pleasure to meet each other at the circular County thousand virtual events.
00:00:06 [W] My name is Wang Ming Chen.
00:00:09 [W] I work as a software engineer at kubermatic.
00:00:14 [W] Let's talk is organized in this way first recall through the cube roots project to verse is cncf for Jack's best manage. It approached machines the same way as kubenetes thus for
00:00:29 [W] Then reintroduce Gardener projects Gardener is the open source project.
00:00:24 [W] That's managed kubermatic clusters life cycle and our offers they run on a day-to-day operations is runs on Mandalore for infrastructure platform, including pure virt.
00:00:38 [W] how curious features can help Gardener to deploy high performance and highly secured kubermatic casters.
00:00:47 [W] Focus mostly on the networking and a storage features that we how to use motors cri-o.
00:01:08 [W] Traverse join the cncf sandbox over a year ago in 2019 is the enables workloads that's running state of the end to be deployed on a same kubernative cluster as containers are running
00:01:23 [W] Some of the kubenetes knative objects such as positions of Auto claims and resources cleanse, its provide a convenient way to describe virtual machine configurations and their
00:01:36 [W] names and resources cleanse its provide a convenient way to describe virtual machine configurations and their state in this example our virtual machine that's convinced our for virtual network interface
00:01:48 [W] In this example a virtual machine but convinced us or virtual network interface and a virtual disks are described as devices API inside of the virtual machine service. Typically, the interface is API.
00:02:03 [W] How the mess Works action figure which Nats Rook they're attached to rather.
00:02:08 [W] that is the kubernative partners for work or additional networks that are defined the network attachment definition. The virtual disks are described in a different API. The information includes such as
00:02:23 [W] discs where the disc is the beta test for cloudiness disk and specifically that this can be referred to an existing virtual
00:02:35 [W] claims
00:02:36 [W] you know addition to the virtual machine apis serverless also provide apis to manage the virtual machine pain planes data volumes and virtual machines States kubevirt can be
00:02:51 [W] Start a lot of shifts and kubenetes as operator that is available as offered a hub Gardener is an open source project that delivers fully-managed kubernative clusters at scale in simple words, imagine that you can create
00:03:03 [W] Source project that delivers fully-managed kubermatic clusters at scale in simple words, imagine that you can create new kubernative instances as pots we can call it kubernative says the service let's take a closer. Look at architecture garden and Ransom kubernative.
00:03:16 [W] Look at architecture garden and runs on kubernative.
00:03:19 [W] We can speed the diagram. You see two three separate clusters. The first Square on the very left side is the garden cluster where all core components run like Gardener API server Gardener contrary manager and Gardener
00:03:35 [W] The second one in the middle the seed cluster as you remember I said Gardener is capable of creating kubernative clusters as pots.
00:03:43 [W] Thus the role of the city's to run control planes of freshly created kubernative instances. Each seat must have running componentconfig Garden lead as you can observe.
00:03:52 [W] There is an analogy to kubernative core components Garden led to kubelet Gardener API server controller manager and scheduler to kubernative ones last but not least the shoot cluster.
00:04:04 [W] On the right side were all worker nodes run. The cluster itself must be created on one of the following Cloud providers listed below. Each provider has a gardener extension that knows how to start a new worker node to summarize this
00:04:20 [W] Elegy to kubernative core components Garden led to kubelet Gardener API server controller manager and scheduler to kubernative ones last but not least the should cluster on the right side were all worker nodes run
00:05:24 [W] Rated kubernetes instance is stretched between seat where cultural plane is resident and shoot where worker nodes are available communication between them takes place via load balancer services and VPN connection.
00:05:37 [W] Recently.
00:05:38 [W] We added the cube that extension that allows customers to use any bare metal environment that supports Linux KVM and allows to start menu kubernative clusters on premise. I must admit that I find this use case very interesting as we run kubeflow fumes as workloads.
00:05:53 [W] Worker nodes it brings some challenges and part of them. We will describe in the following slides.
00:06:00 [W] Why was this Theory I is symmastia, right?
00:06:04 [W] That's elastic kubernative part acute versus the end to attach to a different network other than the default Port Network in order to use modules. You have to install the necessary demon set and
00:06:21 [W] Why was this Theory I is symmastia, right?
00:06:24 [W] That's elastic kubernative part or two verses vm's to attach to a different network other than the default spot Network in order to use Martyrs.
00:06:35 [W] You have to install the necessary demon set and as they are these in the openshift.
00:06:41 [W] These are all pre installed for you.
00:06:43 [W] you. So in this example, we create an index grid-based.
00:06:49 [W] Ipv line in Mabel meshmark attachments definition. So there are multiple types of Motors in rise.
00:06:57 [W] So in this example, we use bridge in that example, as you can see macstadium and IP villain, so the bridge has to exist first.
00:07:06 [W] If you do not have it you have your dual using some other automation can isms to create the bridge on the nose as you want the attachments happen.
00:07:17 [W] the ministry which uses IP VLAN tag one two, three, four on environment, especially when you are running on public allows you may not have access to knative million so you can create
00:07:32 [W] What have access to knative million so you can create kannan we can isms and on top of the tunnel in divide best example vxlan you create the bridge and then using the villains on top of the tunneling.
00:07:48 [W] Then using the villains on top of the tunnel vision device the IP address management use the this example is a whereabouts which allows you to manage IP addresses
00:08:03 [W] Cross the mouse globally there are the types of IP address management such as static which own men she does a Pacific IP addresses or low-cost the local which is limiting Trooper host.
00:08:18 [W] the arms of all cause I was running
00:08:22 [W] kubevirt use motors for a number of use cases. So in this use case, we want to saturate the Network's so the virtual machines can use the default Port Network to access
00:08:37 [W] Knative services such as a pi server and a using a modern other mesh work for data management.
00:08:43 [W] So by separating the two networks the VMS can ensure that the traffic from each of the network will not interfere with each other for such configuration.
00:08:55 [W] We first defined Network attachments definition that describes how the network interface is constructed.
00:09:04 [W] David and how I view management is done. The network attachments definition is referenced in you know, washing machines are meshmark. Say Pi on the right size of
00:09:20 [W] So kpi's surprise on number of types.
00:09:20 [W] The pot pipe is kubenetes partners for the martyrs Hive is reference to the net Network attachments definition used to the format as a namespace flash the name
00:09:36 [W] attachments definition used to the format as a namespace flash the name it's also supports a number of attachments kind of zones such as Bridge as well as the silv
00:09:43 [W] Amazon's such as Bridge as well as well as I'll be once this yellow is to apply the virtual machine demo is applied in the background of what's a lunch at heart.
00:09:55 [W] heart. We are creates unnecessary networking and Mercurial new environments to configure the VM. So is that just runs as desired?
00:10:06 [W] allowing the VM to access both the path Network and other networks is great for the VMS to access a to access all types of services provided by kubernative and other networks, but for security
00:10:21 [W] Environment, it's an AWS.
00:10:23 [W] Most of the ends to be exposed on the part. That's great because you can pin or just attacked of the end without proper that our authorization National policy is a shorter you can get help but is not sufficient.
00:10:38 [W] Authorization Nats. What policy is a shorty go get help but is not sufficient.
00:10:41 [W] So we have a mother configuration for full isolation.
00:10:46 [W] We're out of the end is completely disconnected from the pot Network.
00:10:52 [W] So if you are look at the yellows and the configurations, the only difference is that in the virtual machine meshmark. The API apart network is completely removed only the motors Nats.
00:11:05 [W] weaveworks days
00:11:07 [W] In this configuration, one of them starts is loses access to the partners work.
00:11:14 [W] So the any natural traffic from the kubermatic spok meshmark, we are not as rigid a VM this ensures that the end is in full isolation.
00:11:25 [W] The is all brilliant and is also saved IP address from that pot Network.
00:11:32 [W] That is also sufficient. We were going to see the post configurations.
00:11:36 [W] Use the indifference use cases in gardener.
00:11:41 [W] Spok information in mind now look at some of the acute versus our networking configuration use cases.
00:11:48 [W] The first is high-performance networking configuration.
00:11:51 [W] As you know, the virtual machines are often worked with Cloud native storage space are provisioned by Rook Rook is another cncf project has recently graduated.
00:12:06 [W] Storage it back hand operator has Provisions staff.
00:12:09 [W] I Jeff has enough S as well as Apache Cassandra, one of the recent features you look is that this allows a set of cluster to use citrus Network defined by
00:12:25 [W] Alarms stackrox ter to use surface Network defined by Network attachments definition so that the frontier and the public network.
00:12:26 [W] does it serve clients are interacting with has the best possible bandwidth while does the cross term s Rook where the osds are communicating with each other to shuffle the data to balance the data.
00:12:41 [W] To balance but beta they are separate from the public Nats Rook.
00:12:45 [W] So in this case the VMS and the staff public network reference the same network attachment definition.
00:12:56 [W] So just as there are traffic will be isolated in the same network in this configuration. They can assure that the traffic is not interacting with other networks and the performer is
00:13:10 [W] guaranteed
00:13:13 [W] On a separate occasion for the full isolation configuration the VMS are protected in their own villains in this configuration.
00:13:23 [W] We use Linux Bridge as the connectivity mechanisms in network attachments definition, which the veal Amber embodied in the definition again.
00:13:39 [W] For you environments. That's do not support native VLAN tags.
00:13:44 [W] You can build up our current IP service underneath using the Excellence and creates a bridge device on top of the V. Excellent.
00:13:56 [W] So the vxlan we are emulate a switch trunk.
00:14:00 [W] where just tunnel all the villain between different and point. So this is a
00:14:08 [W] one of the configurations you can reference for Network isolation.
00:14:15 [W] Well, let's push our earnings into practice.
00:14:18 [W] We are used cotton ER and the kubevirt integration as a case study to show that we how we can use the two configurations of models tonight to provide the best performance as well as the best
00:14:33 [W] So record as Gotham the project provides kubernative status stories, it's a Provisions kubermatic clusters on a number of infrastructure platforms.
00:14:35 [W] But if that's all we're extracting the underlying resources, including the cloud environments the infrastructure environment operating system Network and workloads management and such and such but this
00:14:50 [W] School food in the cloud environments that infrastructure development operator system Nats work and what can those management and such and such but this abstractions programmatically and administratively
00:14:57 [W] Programmatically and administratively Alaska Governor to be extended to different platforms.
00:15:03 [W] So the kubermatic across the workloads created by Gardener is called a shoot.
00:15:10 [W] So we have two shoes clusters in this example, the blue shoes cluster consists of our infrastructure can dig that has two networks.
00:15:20 [W] Why is the shared storage of watch the other network in this case the shares Networks?
00:15:27 [W] Refers to the network attachments definition created by Rook for theft public network.
00:15:35 [W] So the reference here we have the subtle reference used use the namespace Rook staff and name staff.
00:15:44 [W] We are refers to the existing Network attachment definition VMS.
00:15:49 [W] That's where use this reference Network attachments that mission to attach to the same crash the staff.
00:15:57 [W] Pain has nestled on the other hand provides a set of information that will be used to create a network attachments definition on the fly.
00:16:08 [W] So this is own private Network attachments definition that we are not be used by other clusters to have another layer of isolation.
00:16:18 [W] The Nats attached that also uses a VLAN 1 2 3 4 1 2 3 4 2 you sure that the veal and of yams?
00:16:27 [W] Fastball by other videos on a different attachment the second excuse cluster the green cluster of the gracious cluster also refers to the same theft storageos Network for
00:16:42 [W] Is this creative all Nats tennis Network by providing a difference that of if configuration for Nats work attachments definition the v-neck if you quitting this case the
00:16:31 [W] She creation for Nats work attachments definition the v-neck if you quitting this case is different.
00:16:36 [W] It's two three four five. So by having to network attachment destination and two villains the grid Network and improved methods are separated physically and symmetrically as
00:16:51 [W] As a difference kubermatic clusters, so this just shows the case that the martyrs Martyrs configuration used by shoes verse can provide a flexibility for different use cases.
00:17:08 [W] Before I start talking about data volume and clone.
00:17:11 [W] I must say a few words about the project behind the containerized data importer.
00:17:16 [W] It's a monk one of my favorite items in kubernative.
00:17:19 [W] The primary goal is to provide a declarative way to build through 12 machine discs.
00:17:24 [W] However, you can use it as well to initialize kubernative volumes with some data out of the kubevirt context CDI includes a custom resource definition that provides a data volume object type
00:17:37 [W] Those objects are in abstraction on top of persistent volume claims and are very helpful in terms of data Imports and uploads on to PVC.
00:17:46 [W] This is a way to automate virtual machine Disk Management without that you would have to prepare a PVC that contains the disk image yourself. One of the good outcomes of CDI integration with kubevirt is that you can specify
00:18:01 [W] Data volume which is tied to the virtual machine life cycle.
00:18:05 [W] You can do it / data volume template in the VM spec. When you delete the virtual machine the data volume would be destroyed two together with the provision storage.
00:18:16 [W] So there is no requirement for the user to take care of the clean-up on the right side of the slide.
00:18:22 [W] We can see a sample data volume defined there. We have two interesting Parts Source and PVC The Source determines if the
00:18:31 [W] data is supposed to be cloned from another persistent volume claim or downloaded from some address in that case in the source.
00:18:39 [W] We would have HTTP options with your L value below.
00:18:43 [W] There is a PVC section as the name indicates.
00:18:46 [W] It's about PVC settings, like what kind of storage class you want to use and how big storage unit to have so having all these details in place data volume would create a new persistent volume clone for our disk the add-on mayadata.
00:19:01 [W] Our Lives much easier, I encourage everybody to check the damn selves if you haven't yet.
00:19:07 [W] I'm going to show the possible usage strategies in the next slide virtual machines images management here. We can see two diagrams that show two different strategies of data volume music ad hoc and pre-allocated data volumes
00:19:22 [W] The first one the ad hoc approach on the left side. As I mentioned in the previous slide. We can download data directly from the Internet by changing Source from persistent volume claim to http with an appropriate URL.
00:19:24 [W] So now considering the scenario where we typed data Volume 2 Virtual Machine by using data volume template in the spec means each time.
00:19:34 [W] We create a new virtual machine each time.
00:19:37 [W] We download the disc this can cause many problems if you want to schedule.
00:19:40 [W] Hundreds or thousands of VMS first you can have performance issues. You might have quite slow network connection or some red limitation even having a network workloads.
00:19:52 [W] Say You must download 4 gigabyte discs for each VM and you run many of those second the end point you are using might disappear causing real liability issues.
00:20:03 [W] Somebody could say that instead of downloading stuff from the internet. You could create let's say our local HTTP server.
00:20:10 [W] I don't know maybe using nginx and serve images from there.
00:20:14 [W] Yes, you could but that doesn't solve all problems.
00:20:18 [W] I mentioned in 100% And you still can cause Network latency on your cluster. Now, let's focus on the pillar created data volume as it helps to get rid of problems.
00:20:30 [W] Only once and you use the volume as a source for other virtual machines you want to bring to life this strategy.
00:20:13 [W] We follow in the gardener kubevirt extension implementation.
00:20:16 [W] We get rid of problems.
00:20:17 [W] I described previously read we reduce Network latency data volume supports two types of cloning and I'm going to describe this in the next slide. We have two ways of data volume cloning host assisted and smart cloning
00:20:33 [W] It on the left side shows a diagram of the traditional cloning of persistent volume claim that is host assisted.
00:20:32 [W] It means there is a data stream from Source PBC to Target PVC.
00:20:37 [W] The entire volume is being copied.
00:20:39 [W] It is a traditional heavyweight approach.
00:20:41 [W] It is not necessarily needed to a storage space and put some additional load on disks just to copy the whole image on the right side.
00:20:51 [W] I show another strategy of volume cloning. It is a feature called snyk.
00:20:55 [W] Smart clone this is being executed when it's possible in order to improve the performance of the cloning process the containerized data import their team introduced smart cloning that uses volume snapshot, of course to use such a feature
00:21:10 [W] Can we choose much support snapshots?
00:21:08 [W] They um structure of the data volume is still the same the data volume automatically checks you smart cloning is possible.
00:21:16 [W] If yes, then create a snapshot of the source PVC next the snapshot is being used to bring a new persistent volume claim.
00:21:24 [W] Finally. The snapshot itself is going to be deleted additionally if you want to use the feature the requirement is to make sure that search spiffe. EC is in the same namespace as
00:21:35 [W] as the target PVC the source and Target PVCs are in the same storage class. And finally there must be a snapshot class associated with the storage class depending on the storage back-end.
00:21:48 [W] You can really benefit from this especially when snapshots are implemented as copy-on-write, which is often on the next slide. I'm going to show you in detail how we deal with disks and volumes Management in the gardener kubevirt extension.
00:22:04 [W] It should cluster that there was talking about at the beginning is defined as a custom resource object.
00:22:09 [W] You can see an example on the left side.
00:22:12 [W] The should be able definition as you can see there is a worker section where users can Define volumes the first one the volume of objects back. It defines a route disc of virtual machine and the second one data volumes, which
00:22:27 [W] Another data volumes discs the worker pull definition is processed by the worker controller in the kubevirt extension based on that an appropriate specification of virtual machine is prepared.
00:22:31 [W] The size parameter is an obvious indication of the storage size and the type determines which storage class should be used.
00:22:39 [W] Somebody could ask.
00:22:41 [W] Why didn't you name the parameter storage class instead of type? We didn't because Gardener supports many Cloud providers and this is the API.
00:22:50 [W] Then following the arrows we can see that volumes are translated to data volume templates.
00:22:56 [W] So data volume is closely related to the virtual machine life cycle by default. The extension uses a plural allocated data volume approach, which means that the first virtual machine created will download the image and other virtual
00:23:11 [W] Carpal will clone the volume.
00:22:58 [W] We use blank data volumes to provide additional discs and storage space.
00:23:02 [W] These are completely blank disc and it's up to the user to handle them one way would be to run cloud in it and format the disk according to the to their needs.
00:23:12 [W] Although I must admit that this is not yet possible to pass users cloudevents scripts in the extension. The reason is that we are using cloud in it to join nodes and we still have to decide how we want to deal with the custom part of cloud in it.
00:23:27 [W] But for sure at some point this feature will land in the extension on that slide.
00:23:32 [W] I'm going to talk about highly insulated clusters and how to upload disk images there.
00:23:37 [W] It happens that customers demand highly insulated environments not so long ago at kubermatic.
00:23:44 [W] We had such a case and environment where we could not pull kubevirt images directly from the internet.
00:23:50 [W] There was only a Bastion host where we could access a cluster and expose the futurewei.
00:23:56 [W] Services outside but still those Services were only visible to the Bastion host each pod couldn't reach the internet somehow we had to provide virtual machine images to the cluster.
00:24:10 [W] We could create a local image repository.
00:24:13 [W] Proxy first users have to expose upload proxy service and it must be accessible from outside. The cluster next. It is required to create a data volume with Source set to upload similar like
00:24:19 [W] And finally, we must request an upload token that can be done over upload talking request custom resource.
00:24:09 [W] The crd of the object comes from the project itself. When all Dimensions steps are complete.
00:24:16 [W] It's time to upload an image.
00:24:18 [W] You can obtain their generated token from the status section of the cri-o.
00:24:33 [W] The synchronous connection can be closed unexpectedly because of the conversion or resizing process that can take some time with a non synchronous up Roach The Connection will be closed as soon as the disk image has been transmitted.
00:24:47 [W] However, you have to check yourself if the process of resizing and conversion is finished for more details and examples.
00:24:55 [W] I encourage you to visit containerized data import our GitHub page the very nice project with servicemeshcon.
00:25:02 [W] As many issues regarding volumes and disks management.
00:25:06 [W] This concludes all talk.
00:25:08 [W] We are so excited to share with you the optimizations in crew versus using markers and they took volumes for high performance and high security configurations.
00:25:19 [W] There are even more features minikube reverse.
00:25:22 [W] That's including the CPU memory storage and networks.
00:25:26 [W] We are looking forward to share with you in the future opportunities.
00:25:36 [W] Thank you for watching.
00:25:39 [W] And we open for Q&A.
00:25:53 [W] So I see oh there's a question in the chat and I'm just so here's the question. How does kubevirt suppose are mediated devices you see in so can use the GPU the answer is there's
00:26:08 [W] So kubevirt supposed to give you what you view as well.
00:25:57 [W] So there's a tip time talking should come 2019 about Scruples and if you workloads
00:26:16 [W] As you see in the kubevirt apis, there are lots of will pass through mechanisms.
00:26:21 [W] You can use to have a knative performance access is a great experiments to have the best practice and hopefully that can be Circle back to the community. We can share them in the future.
00:26:48 [W] So the question is if UDP America's new to be a exposed outside of the class stir I can few verses networking support this abuse case in my opinion that can be done.
00:27:00 [W] So in mountainous you can have additional Network.
00:27:05 [W] So in this additional network is not actually managed by kubenetes per se because it's a ice must pass work. So you can you can create your own Services. It's impossible.
00:27:17 [W] After Marcus Nash work and that can be exposed to the external Networks.
00:27:19 [W] Master do you have anything to add?
00:27:21 [W] No, I think you covered everything.
00:27:23 [W] Okay.
00:27:26 [W] So if one of us is the body cause I'm not I think there's a depends on two issues when it is a multicast is allowing your data center.
00:27:33 [W] I know certain times the data sent out like a car or public clouds may not allow you to have multicast, but if that's Works your data center, it should be working if you're using Motors Network.
00:28:02 [W] so
00:28:06 [W] Okay, so, all right. So this country - question because we received a question here is our how can we are patch of VMI from external Source automation the current status if I'm not mistaken is that you
00:28:21 [W] Buster VM is when you cannot patches, son of things you cannot Spanish by stassi's under under revision and a moment.
00:28:21 [W] So we are going to have some opened up some of the training opportunities.
00:28:27 [W] So if you have like just a storage devices you can mutate the storage section rest of the year and VMware is still running.
00:28:36 [W] So that's why we opened up our automation opportunities for you if more is needed or create a issue.
00:28:43 [W] Shoo request of feature on futurists gets hot GitHub repo and certainly we will be glad to hear your use cases.
00:29:03 [W] All right.
00:29:04 [W] much.
00:29:07 [W] Thank you guys.
00:29:16 [W] All right, we have maybe we still got time for one more question if there's a two-minute window left.
00:29:29 [W] Now you saw my few verses very Vibrant Community.
00:29:33 [W] All right.
00:29:29 [W] we have maybe we still got time for one more question if there's a two-minute window left.
00:29:41 [W] Now is a rival few verses very Vibrant Community.
00:29:45 [W] We definitely are a lot of use cases and a lot of our community feedbacks and there's a lot of customer engagements using the products and we are very happy that to present. Some of the progress
00:30:09 [W] Actually, that's a shoe trees and some of the progress is here.
00:30:13 [W] So if you are looking back a few years looking back a cube computations are few years back.
00:30:20 [W] There have been a lot of the services. They run kubevirt become to the project.
00:30:26 [W] been Deep dive talks ever since and hopefully in the future talks we can cover more of the use cases and techniques. Do you still keep calm now convert?
00:30:45 [W] So additionally few virtues are lots of kubenetes knative API as well. As any of the appear on the Technologies from cncf projects.
00:30:56 [W] So if there's a warped integration as well makes sense to use so soon for certain use cases.
00:31:02 [W] I think that will also help you not just strong community.
00:31:08 [W] Yeah, and two guys, you should definitely jump in to keep the channel. If you need some help. There are this is very helpful and open community.
00:31:18 [W] So I encourage you to use kubevirt and check yourself.
00:31:29 [W] And I understand this is the last day of the cube Cube Khan, and so enjoy your time here.
00:32:34 [W] That's fine.
00:33:04 [W] That's fine.
